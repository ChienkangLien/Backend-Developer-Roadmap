# SAML
Security Assertion Markup Language (安全聲明標記語言)，在身分識別資訊提供者（Identity Provider，IdP）與服務提供者（Service Provider，SP）之間傳送驗證以及授權資料的一種公開標準。

由於 session 無法在跨網域或跨伺服器的情況下使用，並且跨網域使用 cookie 也存在非常高的風險。SAML 便是一個解決這個問題的公開標準，從而使單一登入（Single Sign-On，SSO）技術成為可能。

## 角色
* 主體：即是使用者。
* 身分識別資訊提供者（Identity Provider，IdP）：含有使用者身分資訊的服務端。
* 服務提供者（Service Provider，SP）：在接收到身分識別資訊提供者所提供的資訊後，進而提供服務給通過驗證的使用者的服務端。

## SAML 宣告
宣告（Assertion）是一個關鍵的 XML 文檔，它包含了有關用戶身份和相關權限的信息。這個宣告是由身份提供者（IdP）簽署的，並由它發送給服務提供者（SP）作為身份驗證和授權的一部分。

宣告的結構：
* XML 格式：宣告是一個基於 XML 的文件，具有特定的結構和元素，包含有關用戶身份、授權信息以及其他相關的元數據。
* 範例元素：宣告可能包含用戶的姓名、電子郵件地址、角色、權限、過期時間等信息。

簽署和驗證：
* 由 IdP 簽署：宣告由身份提供者簽署，以確保它的完整性和真實性。
* SP 驗證：服務提供者會驗證宣告的簽署，以確保它是由信任的 IdP 簽發的。

宣告的類型：
* 身份宣告（Authentication Assertion）：用於證明用戶身份，包含了驗證成功的信息。
* 授權宣告（Authorization Assertion）：包含有關用戶授權和權限的信息。

宣告的傳遞：
* 透過重定向或直接傳遞：宣告可以通過 HTTP POST、重定向等方式傳遞給服務提供者。
* 透過簽名和加密保護：宣告通常使用數位簽名來保護其內容的完整性和真實性，並可以加密以保護敏感信息。

## 流程
1. 當 使用者 想要使用 服務提供者 所提供的服務時，使用者會先試著登入 服務提供者。
2. 接著，服務提供者 會將這項請求重新導向至 身分識別資訊提供者，並試圖從 身分識別資訊提供者 取得驗證以及授權的資料。
3. 使用者 在 身分識別資訊提供者 的網頁完成驗證後，身分識別資訊提供者 便會回傳一封訊息證明該 使用者 已經通過了驗證以及一些 使用者 身分的相關資訊。

簡而言之，這封訊息的功用是作為一項證明身分識別資訊提供者已經授權使用者的證據，服務提供者在接獲證據後便會提供服務給已被授權的使用者。

## SAML、OAuth 和 OpenID Connect (OIDC) 之間區別
SAML 是一種廣泛適用的身份驗證協議，而 OAuth 是一種授權標準，旨在與特定應用程式、裝置或 API 一起使用，以提供安全的委派存取。一個用於驗證使用者身份，另一個用於授權特定存取。

OIDC 是一種身份驗證協議，專門為 OAuth 2.0 添加安全層。使用 JSON Web 令牌 (JWT) 驗證最終使用者的身份，使用戶能夠使用一組登入憑證登入多個網站。

儘管 SAML 和 OAuth 都是可互通的標準，但它們的用途差異很大。SAML 處理授予存取權限的功能，而 OAuth 處理確定可以存取和不可以存取的內容的功能。

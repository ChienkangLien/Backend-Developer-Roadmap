# Backpressure
背壓(Backpressure) 是一種控制系統間通信的機制，用於處理當消費者無法即時處理來自生產者的資料或訊息時所產生的情況。這個概念通常應用於異步處理或資料流式的系統中，其中生產者和消費者的處理速率不一致。

## 在系統設計中的應用：
1. 資料庫系統： 當資料庫無法即時處理所有請求時，可以使用 Backpressure 來通知應用程式減緩請求速率，避免過度的請求壓力。
2. 流式處理系統： 在資料流式處理中，當處理速率與資料產生速率不匹配時，Backpressure 可以讓系統自動調整處理速率，以避免資料丟失或系統壓力過大。
3. 異步消息系統： 在異步通信中，當消息產生速率高於消費者處理速率時，Backpressure 可以通知消息發送方減緩發送速率，以避免消息佇列的過度增長。

## 實現方法：
1. Reactive Streams 標準： 使用 Reactive Streams 標準（例如 Java 的 Reactor、RxJava、Scala 的 Akka Streams）來處理異步資料流，這些框架提供了符合 Backpressure 的特性，使得生產者和消費者之間的速率不會不匹配。
2. 訂閱-訂閱模式： 生產者和消費者之間建立一種訂閱-訂閱的通訊模式，消費者可以向生產者發送回饋，告訴它自己的處理速率。
3. 緩衝區： 在資料流程中加入緩衝區，當消費者暫時無法處理資料時，將資料暫存於緩衝區中。當消費者準備好時，再從緩衝區中取出資料進行處理。
4. 限流機制： 設置請求的速率限制，例如每秒處理的請求數量，防止生產者過快地產生資料。
5. 丟棄策略： 當消費者無法跟上生產者的速率時，可以根據一定的策略丟棄部分資料。這可能會導致資料遺失，因此需要謹慎使用。
6. 反饋機制： 監控整個資料流程，當檢測到消費者無法處理時，透過反饋機制通知生產者減緩資料生成速率。
7. 自適應調整： 根據系統的狀態和性能，動態調整處理速率和資料流量，以適應當前的負載和效能情況。
8. 壓力測量和監控： 監控整個系統的壓力和效能，以便及時檢測到潛在的 Backpressure 問題並採取適當的措施。

### Reactive Streams
Reactive Streams 是一個設計用於異步資料流處理的規範，旨在解決在非同步環境中產生的 Backpressure 問題。它提供了一種標準的方法，使得生產者和消費者可以以不同的速率處理資料流，同時避免過度負載和資源浪費。

Reactive Streams 的主要元件：
* Publisher（發布者）： 發布者負責生成資料流，它可以是資料的來源，將資料推送給消費者。
* Subscriber（訂閱者）： 訂閱者訂閱了發布者的資料流，接收和處理資料。Subscriber 可以向 Publisher 發送 Backpressure 信號，告訴它自己的處理速率。
* Subscription（訂閱）： 訂閱是發布者和訂閱者之間的合約，它包含了訂閱者向發布者發送 Backpressure 信號的能力。
* Processor（處理器）： 處理器既是發布者又是訂閱者，它可以接收來自發布者的資料，處理後再發送給訂閱者。

Reactive Streams 的特性：
* Backpressure 控制： Reactive Streams 重要的特性是能夠處理 Backpressure，這意味著消費者可以控制資料流的速率，通過告知發布者自己的處理速率。
* 異步非阻塞： Reactive Streams 的設計目標之一是支持異步非阻塞處理，讓程式可以更有效地使用資源。
* 合理使用資源： Reactive Streams 可以幫助避免資源浪費，因為它可以控制資料流速率，不會造成資源過度消耗。

Reactive Streams 的規範被許多流行的程式語言和框架所採用和實現，例如 Java 的 Reactor、RxJava，Scala 的 Akka Streams，以及在 JavaScript 領域的 RxJS 等。這些框架提供了 Reactive Streams 的實際操作和應用，使得開發者可以更容易地利用 Reactive Streams 的特性來設計異步資料處理流程。
# Data Replication
專有名詞：
1. Master-Slave（主從）或 Primary-Secondary（主次）：
主節點（Master或Primary）：在主從複製中，主節點是資料的源頭，通常處理寫操作。
從屬節點（Slave或Secondary）：從屬節點複製主節點的資料，通常處理讀操作。
2. Replication Lag（複製延遲）：
指從主節點複製資料到從屬節點之間的時間延遲。複製延遲可能是因為網路延遲、資源限制或複製策略等原因造成的。

## 架構
1. 主從複製架構（Master-Slave Replication Architecture）：
主節點（Master）是資料的源頭，而從屬節點（Slave）複製主節點的資料。這種架構常見於資料庫複製、分佈式系統。
2. 多主節點複製架構（Multi-Master Replication Architecture）：
所有參與複製的伺服器都可以接收寫入操作，並且對任何伺服器所做的所有更新都會複製到所有其他伺服器。
3. 點對點複製(Peer-to-Peer Replication)：
所有節點彼此相互連接，可以互相複製資料。每個節點都既是資料的源頭，又是複製的目標；即每個伺服器都可以是主也可以是從。這種架構允許資料在不同節點之間互相同步。
4. 單一來源複製(Single-source replication)：
資料的複製是從單一來源節點到其他多個從屬節點。單一來源節點負責提供資料，而從屬節點則複製這個來源節點的資料。

## 複製策略
### 基於日誌的增量複製（Log-Based Incremental Replication）
查看日誌，識別資料來源的更改，然後在副本資料目標（例如資料庫）中重現更改。這些變更可能是對來源資料庫的 INSERT、UPDATE 或 DELETE 操作。

優點
* 由於基於日誌的增量複製僅捕獲對來源的基於行的變更並定期更新（例如每小時一次），因此在目標資料庫中複製這些變更時的延遲較低。
* 來源上的負載也減少了，因為它僅傳輸對表的變更。
* 由於來源始終儲存更改，因此我們可以相信它不會錯過重要的業務交易。

缺點
* 僅適用於支援二進位日誌複製的資料庫，例如MongoDB、MySQL、PostgreSQL。
* 由於每個資料庫都有自己的日誌格式，因此很難建立涵蓋所有支援的資料庫的通用解決方案。
* 如果目標伺服器發生故障，必須保持日誌的更新，直到伺服器恢復為止，否則將丟失重要資料。

### 基於密鑰的增量複製(Key-Based Incremental Replication)
資料庫中的每條資料通常有一個唯一的識別密鑰(複製密鑰)（例如主鍵、時間戳記），當資料被修改、插入或刪除時，系統會記錄相應密鑰的變更，而不是整個資料的變更。若來源的密鑰值比較大，就會進行複製。

優點
* 僅傳輸和處理已變更的資料部分，減少了複製過程中的資料量和處理負擔，提高了效能。

缺點
* 它不識別來源中的刪除操作。當您刪除表中的資料條目時，您也會從來源中刪除複製鍵。因此複製工具無法擷取對該條目的變更。

### 全表複製(Full Table Replication)
顧名思義，複製所有內容。明顯的缺點是所需成本、資源的消耗。

### 快照複製(Snapshot Replication)
它只是來源的快照，並不追蹤來源資料庫的變更，適合資料不頻繁異動，或者只需定期更新資料。

對於快照複製，我們需要兩個代理：
1. 快照代理（Snapshot Agent）：
生成快照： 負責在指定時間點生成資料的快照。
處理快照設定： 管理快照複製的時間表、頻率和其他設定。
2. 分發代理（Distribution Agent）：
傳送快照： 將生成的快照傳送到目標位置或其他節點。
處理複製過程： 管理複製的傳輸、同步和錯誤處理。

優點
* 有助於快速恢復到特定時間點的資料狀態，節省傳輸和處理時間。

缺點
* 不適合需要即時或連續同步的應用，因為快照不是即時反映資料變更的。
* 如果資料量過大，就像全表資料一樣耗用成本。
* 副本與來源可能暫時不同步。

### 事務複製(Transactional Replication)
對發布者的任何更改幾乎立即以相同的順序複製到訂閱者中。
要執行交易複製，以下重要元件：
* 快照代理：工作方式與快照複製的快照代理相同。它產生所有相關的快照檔案。
* 日誌讀取代理：監聽來源的交易日誌並複製交易到分發資料庫。
* 分發代理：將快照檔案和交易日誌從分發資料庫複製到目標伺服器。
* 分發資料庫：儲存文件和交易，直到它們準備好轉移給訂閱者。

適合資料庫經常變更、並需要即時反映變化。
### 合併複製(Merge Replication)
將多個節點中的資料合併為一致的資料集。它通常應用於多點資料同步的場景，使多個節點的資料保持同步並互相合併更新。

對於合併複製，我們需要兩個代理：
1. 快照代理（Snapshot Agent）：
與大多數資料複製策略一樣，合併複製首先拍攝主資料庫的快照，然後將資料複製到目標資料庫中。
2. 合併代理(Merge Agent)：
在其他資料庫中重現資料更新，識別並解決複製作業期間的所有資料衝突。

優點
* 彈性和分散式： 各個節點可以獨立工作並進行資料修改，並允許節點的離線。
* 合併和同步： 透過定期或特定條件下的合併操作，確保了各個節點的資料是一致和同步的。

缺點
* 衝突：若合併複製機制無法解決資料衝突，可能需要手動處理。

### 雙向複製(Bidirectional Replication)
較不常見的複製策略，它是事務複製的一個子集，允許兩個資料庫交換其更新。因此，兩個資料庫都必須處於活動狀態。
可以選擇每個資料庫可以修改哪些行或列。還可以決定在衝突的情況下哪個資料庫具有更高的優先級，即決定首先反映哪些資料庫的更新。